{% extends 'index.html' %}
{% load i18n static basefilters horillafilters %}

{% block content %}
<!-- Premium CSS -->
<link rel="stylesheet" href="{% static 'employee/css/dashboard_advanced.css' %}?v=2.0">

<div class="dashboard-page" style="padding: 2rem;">

    <!-- Header -->
    <div class="dashboard-header" style="justify-content: space-between; margin-bottom: 2rem;">
        <div class="info">
            <h2>{% trans "Leave Management" %}</h2>
            <p>{% trans "Track balances, apply for leave, and view history" %}</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="button"
                style="background: var(--color-primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;"
                data-bs-toggle="modal" data-bs-target="#applyLeaveModal">
                <ion-icon name="add-outline" class="me-2"></ion-icon> {% trans "Apply Leave" %}
            </button>
            <button class="button" onclick="showHolidaysCalendar()"
                style="background: var(--color-surface); color: var(--color-text); padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;">
                <ion-icon name="calendar-number-outline" class="me-2"></ion-icon> {% trans "Holidays" %}
            </button>
        </div>
    </div>

    <!-- Navigation Tabs (Optional visual separation or keep as buttons above) -->
    <!-- We'll keep the buttons above as main actions, and use tabs for switching views if needed, 
         but here we have a dashboard grid view as default. -->

    <!-- Key Metrics Grid -->
    <div class="dashboard-grid"
        style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); margin-bottom: 2rem;">

        <!-- Annual Leave -->
        <div class="dashboard-card" style="position: relative; overflow: hidden;">
            <h3 style="font-size: 1.1em; color: #4facfe;">{% trans "Annual Leave" %}</h3>
            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">18<span
                    style="font-size: 0.5em; opacity: 0.7;">/25</span></div>
            <p style="opacity: 0.7;">{% trans "Days Available" %}</p>
            <ion-icon name="calendar-outline"
                style="position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.05;"></ion-icon>
        </div>

        <!-- Sick Leave -->
        <div class="dashboard-card" style="position: relative; overflow: hidden;">
            <h3 style="font-size: 1.1em; color: #43e97b;">{% trans "Sick Leave" %}</h3>
            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">8<span
                    style="font-size: 0.5em; opacity: 0.7;">/12</span></div>
            <p style="opacity: 0.7;">{% trans "Days Available" %}</p>
            <ion-icon name="medical-outline"
                style="position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.05;"></ion-icon>
        </div>

        <!-- Personal Leave -->
        <div class="dashboard-card" style="position: relative; overflow: hidden;">
            <h3 style="font-size: 1.1em; color: #fad0c4;">{% trans "Personal Leave" %}</h3>
            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">3<span
                    style="font-size: 0.5em; opacity: 0.7;">/5</span></div>
            <p style="opacity: 0.7;">{% trans "Days Available" %}</p>
            <ion-icon name="person-outline"
                style="position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.05;"></ion-icon>
        </div>

        <!-- Pending -->
        <div class="dashboard-card" style="position: relative; overflow: hidden;">
            <h3 style="font-size: 1.1em; color: #fccb90;">{% trans "Pending" %}</h3>
            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">2</div>
            <p style="opacity: 0.7;">{% trans "Requests Awaiting" %}</p>
            <ion-icon name="hourglass-outline"
                style="position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.05;"></ion-icon>
        </div>

    </div>

    <!-- Main Content Split -->
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">

        <!-- Chart Section -->
        <div class="dashboard-card">
            <h3 style="margin-bottom: 1.5rem;">{% trans "Overview" %}</h3>
            <div style="height: 300px; position: relative;">
                <canvas id="leaveBalanceChart"></canvas>
            </div>
            <div
                style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.9em; opacity: 0.8;">
                <!-- Legend items can go here if needed, but ChartJS has legend -->
            </div>
        </div>

        <!-- History / Recents -->
        <div class="dashboard-card">
            <h3 style="margin-bottom: 1.5rem;">{% trans "Recent History" %}</h3>

            <div class="table-responsive">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                            <th style="padding: 12px;">{% trans "Type" %}</th>
                            <th style="padding: 12px;">{% trans "Dates" %}</th>
                            <th style="padding: 12px;">{% trans "Days" %}</th>
                            <th style="padding: 12px;">{% trans "Status" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td style="padding: 12px;">{% trans "Annual Leave" %}</td>
                            <td style="padding: 12px;">Dec 25 - Dec 26, 2024</td>
                            <td style="padding: 12px;">2</td>
                            <td style="padding: 12px;"><span class="badge" style="background: #2ecc71; color: white;">{%
                                    trans "Approved" %}</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td style="padding: 12px;">{% trans "Sick Leave" %}</td>
                            <td style="padding: 12px;">Nov 15 - Nov 16, 2024</td>
                            <td style="padding: 12px;">2</td>
                            <td style="padding: 12px;"><span class="badge" style="background: #2ecc71; color: white;">{%
                                    trans "Approved" %}</span></td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td style="padding: 12px;">{% trans "Personal Leave" %}</td>
                            <td style="padding: 12px;">Dec 30 - Dec 31, 2024</td>
                            <td style="padding: 12px;">2</td>
                            <td style="padding: 12px;"><span class="badge" style="background: #f1c40f; color: black;">{%
                                    trans "Pending" %}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</div>

<!-- Keeping the original Modal as is, but ensuring it works -->
<!-- Apply Leave Modal -->
<div class="modal fade" id="applyLeaveModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Apply for Leave" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="leaveApplicationForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{% trans "Leave Type" %}</label>
                            <select class="form-select" required>
                                <option value="">{% trans "Select Leave Type" %}</option>
                                <option value="annual">{% trans "Annual Leave" %}</option>
                                <option value="sick">{% trans "Sick Leave" %}</option>
                                <option value="personal">{% trans "Personal Leave" %}</option>
                                <option value="maternity">{% trans "Maternity Leave" %}</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{% trans "Duration" %}</label>
                            <select class="form-select" required>
                                <option value="full">{% trans "Full Day" %}</option>
                                <option value="half">{% trans "Half Day" %}</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{% trans "Start Date" %}</label>
                            <input type="date" class="form-control" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">{% trans "End Date" %}</label>
                            <input type="date" class="form-control" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{% trans "Reason" %}</label>
                        <textarea class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{% trans "Attachment" %} ({% trans "Optional" %})</label>
                        <input type="file" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                <button type="button" class="btn btn-primary">{% trans "Submit Application" %}</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function initLeaveBalanceChart() {
        const ctx = document.getElementById('leaveBalanceChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['{% trans "Used" %}', '{% trans "Available" %}'],
                datasets: [{
                    data: [7, 18],
                    backgroundColor: ['#e74c3c', '#2ecc71'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#ccc' }
                    }
                },
                cutout: '70%',
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        initLeaveBalanceChart();
    });

    function showHolidaysCalendar() {
        alert("Holiday calendar overlay or modal can be added here.");
    }
</script>
{% endblock content %}